<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.10">
<link rel="icon" type="image/png" href="/morpheus_fav_16.png">
<title>Morpheus Plugin Documentation</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/* Asciidoctor default stylesheet | MIT License | https://asciidoctor.org */
/* Uncomment @import statement to use as custom stylesheet */
/*@import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700";*/
article,aside,details,figcaption,figure,footer,header,hgroup,main,nav,section{display:block}
audio,video{display:inline-block}
audio:not([controls]){display:none;height:0}
html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}
a{background:none}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
abbr[title]{border-bottom:1px dotted}
b,strong{font-weight:bold}
dfn{font-style:italic}
hr{-moz-box-sizing:content-box;box-sizing:content-box;height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type="button"],input[type="reset"],input[type="submit"]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type="checkbox"],input[type="radio"]{box-sizing:border-box;padding:0}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,*::before,*::after{-moz-box-sizing:border-box;-webkit-box-sizing:border-box;box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;font-weight:400;font-style:normal;line-height:1;position:relative;cursor:auto;tab-size:4;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.center{margin-left:auto;margin-right:auto}
.stretch{width:100%}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0;direction:ltr}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:0}
p{font-family:inherit;font-weight:400;font-size:1em;line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #dddddf;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em;height:0}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{font-size:1em;line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0;font-size:1em}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
abbr,acronym{text-transform:uppercase;font-size:90%;color:rgba(0,0,0,.8);border-bottom:1px dotted #ddd;cursor:help}
abbr{text-transform:none}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote cite{display:block;font-size:.9375em;color:rgba(0,0,0,.6)}
blockquote cite::before{content:"\2014 \0020"}
blockquote cite a,blockquote cite a:visited{color:rgba(0,0,0,.6)}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:solid 1px #dedede}
table thead,table tfoot{background:#f7f8f7}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt{background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{display:table-cell;line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:" ";display:table}
.clearfix::after,.float-group::after{clear:both}
:not(pre):not([class^=L])>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background:#f7f7f8;-webkit-border-radius:4px;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed;word-wrap:break-word}
:not(pre)>code.nobreak{word-wrap:normal}
:not(pre)>code.nowrap{white-space:nowrap}
pre{color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;line-height:1.45;text-rendering:optimizeSpeed}
pre code,pre pre{color:inherit;font-size:inherit;line-height:inherit}
pre>code{display:block}
pre.nowrap,pre.nowrap pre{white-space:pre;word-wrap:normal}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background:#f7f7f7;border:1px solid #ccc;-webkit-border-radius:3px;border-radius:3px;-webkit-box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em white inset;box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em #fff inset;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}
b.button::before{content:"[";padding:0 3px 0 2px}
b.button::after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin-left:auto;margin-right:auto;margin-top:0;margin-bottom:0;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header::before,#header::after,#content::before,#content::after,#footnotes::before,#footnotes::after,#footer::before,#footer::after{content:" ";display:table}
#header::after,#content::after,#footnotes::after,#footer::after{clear:both}
#content{margin-top:1.25em}
#content::before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #dddddf}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #dddddf;padding-bottom:8px}
#header .details{border-bottom:1px solid #dddddf;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:-ms-flexbox;display:-webkit-flex;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span::before{content:"\00a0\2013\00a0"}
#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark::before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber::after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #dddddf;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #e7e7e9;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #e7e7e9;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #e7e7e9;left:auto;right:0}}
@media screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:100%;background:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:rgba(255,255,255,.8);line-height:1.44}
#content{margin-bottom:.625em}
.sect1{padding-bottom:.625em}
@media screen and (min-width:768px){#content{margin-bottom:1.25em}
.sect1{padding-bottom:1.25em}}
.sect1:last-child{padding-bottom:0}
.sect1+.sect1{border-top:1px solid #e7e7e9}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
details,.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
details>summary:first-of-type{cursor:pointer;display:list-item;outline:none;margin-bottom:.75em}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}
.paragraph.lead>p,#preamble>.sectionbody>[class="paragraph"]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,.85)}
table.tableblock #preamble>.sectionbody>[class="paragraph"]:first-of-type p{font-size:inherit}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #dddddf;color:rgba(0,0,0,.6)}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border-style:solid;border-width:1px;border-color:#e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;-webkit-border-radius:4px;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border-style:solid;border-width:1px;border-color:#dbdbd6;margin-bottom:1.25em;padding:1.25em;background:#f3f3f2;-webkit-border-radius:4px;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock>.content>pre{-webkit-border-radius:4px;border-radius:4px;word-wrap:break-word;overflow-x:auto;padding:1em;font-size:.8125em}
@media screen and (min-width:768px){.literalblock pre,.listingblock>.content>pre{font-size:.90625em}}
@media screen and (min-width:1280px){.literalblock pre,.listingblock>.content>pre{font-size:1em}}
.literalblock pre,.listingblock>.content>pre:not(.highlight),.listingblock>.content>pre[class="highlight"],.listingblock>.content>pre[class^="highlight "]{background:#f7f7f8}
.literalblock.output pre{color:#f7f7f8;background:rgba(0,0,0,.9)}
.listingblock>.content{position:relative}
.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:inherit;opacity:.5}
.listingblock:hover code[data-lang]::before{display:block}
.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:inherit;opacity:.5}
.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;-webkit-border-radius:4px;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.prettyprint{background:#f7f7f8}
pre.prettyprint .linenums{line-height:1.45;margin-left:2em}
pre.prettyprint li{background:none;list-style-type:inherit;padding-left:0}
pre.prettyprint li code[data-lang]::before{opacity:1}
pre.prettyprint li:not(:first-child) code[data-lang]::before{display:none}
table.linenotable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.linenotable td[class]{color:inherit;vertical-align:top;padding:0;line-height:inherit;white-space:normal}
table.linenotable td.code{padding-left:.75em}
table.linenotable td.linenos{border-right:1px solid currentColor;opacity:.35;padding-right:.5em}
pre.pygments .lineno{border-right:1px solid currentColor;opacity:.35;display:inline-block;margin-right:.75em}
pre.pygments .lineno::before{content:"";margin-right:-.125em}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock:not(.excerpt)>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.75em;margin-right:.5ex;text-align:right}
.verseblock{margin:0 1em 1.25em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract blockquote::before,.quoteblock.excerpt blockquote::before,.quoteblock .quoteblock blockquote::before{display:none}
.quoteblock.abstract blockquote,.quoteblock.abstract p,.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{line-height:1.6;word-spacing:0}
.quoteblock.abstract{margin:0 1em 1.25em;display:block}
.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}
.quoteblock.excerpt>blockquote,.quoteblock .quoteblock{padding:0 0 .25em 1em;border-left:.25em solid #dddddf}
.quoteblock.excerpt,.quoteblock .quoteblock{margin-left:0}
.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{color:inherit;font-size:1.0625rem}
.quoteblock.excerpt .attribution,.quoteblock .quoteblock .attribution{color:inherit;text-align:left;margin-right:0}
table.tableblock{max-width:100%;border-collapse:separate}
p.tableblock:last-child{margin-bottom:0}
td.tableblock>.content>:last-child{margin-bottom:-1.25em}
td.tableblock>.content>:last-child.sidebarblock{margin-bottom:0}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>thead>tr>.tableblock,table.grid-all>tbody>tr>.tableblock{border-width:0 1px 1px 0}
table.grid-all>tfoot>tr>.tableblock{border-width:1px 1px 0 0}
table.grid-cols>*>tr>.tableblock{border-width:0 1px 0 0}
table.grid-rows>thead>tr>.tableblock,table.grid-rows>tbody>tr>.tableblock{border-width:0 0 1px}
table.grid-rows>tfoot>tr>.tableblock{border-width:1px 0 0}
table.grid-all>*>tr>.tableblock:last-child,table.grid-cols>*>tr>.tableblock:last-child{border-right-width:0}
table.grid-all>tbody>tr:last-child>.tableblock,table.grid-all>thead:last-child>tr>.tableblock,table.grid-rows>tbody>tr:last-child>.tableblock,table.grid-rows>thead:last-child>tr>.tableblock{border-bottom-width:0}
table.frame-all{border-width:1px}
table.frame-sides{border-width:0 1px}
table.frame-topbot,table.frame-ends{border-width:1px 0}
table.stripes-all tr,table.stripes-odd tr:nth-of-type(odd),table.stripes-even tr:nth-of-type(even),table.stripes-hover tr:hover{background:#f8f8f7}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{display:table-cell;line-height:1.6;background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
ol>li p,ul>li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
ul.checklist{margin-left:.625em}
ul.checklist li>p:first-child>.fa-square-o:first-child,ul.checklist li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist li>p:first-child>input[type="checkbox"]:first-child{margin-right:.25em}
ul.inline{display:-ms-flexbox;display:-webkit-box;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}
ul.inline>li{margin-left:1.25em}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:solid 4px #fff;-webkit-box-shadow:0 0 0 1px #ddd;box-shadow:0 0 0 1px #ddd}
.imageblock.left{margin:.25em .625em 1.25em 0}
.imageblock.right{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
.gist .file-data>table{border:0;background:#fff;width:100%;margin-bottom:0}
.gist .file-data>table td.line-data{width:99%}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background:#00fafa}
.black{color:#000}
.black-background{background:#000}
.blue{color:#0000bf}
.blue-background{background:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background:#fa00fa}
.gray{color:#606060}
.gray-background{background:#7d7d7d}
.green{color:#006000}
.green-background{background:#007d00}
.lime{color:#00bf00}
.lime-background{background:#00fa00}
.maroon{color:#600000}
.maroon-background{background:#7d0000}
.navy{color:#000060}
.navy-background{background:#00007d}
.olive{color:#606000}
.olive-background{background:#7d7d00}
.purple{color:#600060}
.purple-background{background:#7d007d}
.red{color:#bf0000}
.red-background{background:#fa0000}
.silver{color:#909090}
.silver-background{background:#bcbcbc}
.teal{color:#006060}
.teal-background{background:#007d7d}
.white{color:#bfbfbf}
.white-background{background:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background:rgba(0,0,0,.8);-webkit-border-radius:100px;border-radius:100px;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]::after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background:#fffef7;border-color:#e0e0dc;-webkit-box-shadow:0 1px 4px #e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@page{margin:1.25cm .75cm}
@media print{*{-webkit-box-shadow:none!important;box-shadow:none!important;text-shadow:none!important}
html{font-size:80%}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]::after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #dddddf!important;padding-bottom:0!important}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span::before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]::before{display:block}
#footer{padding:0 .9375em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
@media print,amzn-kf8{#header>h1:first-child{margin-top:1.25rem}
.sect1{padding:0!important}
.sect1+.sect1{border:0}
#footer{background:none}
#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}
@media amzn-kf8{#header,#content,#footnotes,#footer{padding:0}}
</style>
</head>
<body class="book toc2 toc-left">
<div id="header">
<h1>Morpheus Plugin Documentation</h1>
<div class="details">
<span id="revnumber">version 0.13.4-SNAPSHOT</span>
</div>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#introduction">Introduction</a>
<ul class="sectlevel2">
<li><a href="#release-notes">Release Notes</a></li>
</ul>
</li>
<li><a href="#getting-started">Getting Started</a>
<ul class="sectlevel2">
<li><a href="#gradle-project">Gradle project</a></li>
<li><a href="#plugin-class">Plugin Class</a></li>
<li><a href="#registering-providers">Registering Providers</a></li>
<li><a href="#settings">Settings</a></li>
</ul>
</li>
<li><a href="#contexts-services">Contexts / Services</a></li>
<li><a href="#models">Models</a></li>
<li><a href="#http-routing">HTTP Routing</a>
<ul class="sectlevel2">
<li><a href="#models-2">Models</a></li>
<li><a href="#example">Example</a></li>
</ul>
</li>
<li><a href="#http-api-client">HTTP API Client</a>
<ul class="sectlevel2">
<li><a href="#example-2">Example</a></li>
</ul>
</li>
<li><a href="#views">Views</a>
<ul class="sectlevel2">
<li><a href="#rendering-a-view">Rendering a view</a></li>
<li><a href="#asset-helper">Asset helper</a></li>
</ul>
</li>
<li><a href="#option-sources">Option Sources</a>
<ul class="sectlevel2">
<li><a href="#getting-started-2">Getting Started</a></li>
</ul>
</li>
<li><a href="#testing">Testing</a>
<ul class="sectlevel2">
<li><a href="#example-3">Example</a></li>
</ul>
</li>
<li><a href="#seeding-data-during-plugin-installation">Seeding data during plugin installation</a>
<ul class="sectlevel2">
<li><a href="#example-4">Example</a></li>
</ul>
</li>
<li><a href="#examples">Examples</a>
<ul class="sectlevel2">
<li><a href="#task-plugin">Task Plugin</a></li>
<li><a href="#ui-extensions">UI Extensions</a></li>
<li><a href="#templating">Templating</a></li>
<li><a href="#catalog-layouts-plugin">Catalog Layouts Plugin</a></li>
<li><a href="#reports-plugin">Reports Plugin</a></li>
<li><a href="#approvals-plugin">Approvals plugin</a></li>
<li><a href="#ipamdns-plugins">IPAM/DNS Plugins</a></li>
<li><a href="#cloud-provider-plugins">Cloud Provider Plugins</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div id="content">
<div class="sect1">
<h2 id="introduction">Introduction</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The Morpheus Plugin API is a Java 8 based library for creating Plugins that add functionality to Morpheus. The Plugin api supports implementing providers to Morpheus of the following types:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>UI Extensions</p>
</li>
<li>
<p>Task Types</p>
</li>
<li>
<p>IPAM</p>
</li>
<li>
<p>DNS</p>
</li>
<li>
<p>Approvals</p>
</li>
<li>
<p>Cypher Modules</p>
</li>
<li>
<p>Custom Reports</p>
</li>
<li>
<p>Cloud Providers</p>
</li>
<li>
<p>Network Providers</p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="release-notes">Release Notes</h3>
<div class="paragraph">
<p><strong>Note:</strong> The <code>morpheus-plugin-api</code> is still pre 1.0 and therefore core interfaces could change between releases. The minimum morpheus version needed to leverage some plugins starts with the 5.4.x series, however anything using plugin core 0.12.0 and above needs to use Morpheus 5.4.1 minimum. 5.5.x Morpheus versions use 0.13.x plugin-api</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>0.13.1</strong> - Added Credential Providers support as well as significant CloudProvider refactoring (more to follow)</p>
</li>
<li>
<p><strong>0.12.5</strong> - Task Providers now have a hasResults flag for result variable chaining.</p>
</li>
<li>
<p><strong>0.12.4</strong> - IPAM NetworkPoolType filters for handling multiple pool types in one integration. Deprecated reservePoolAddress from IPAMProvider as its no longer needed. Added typeCode to the <code>NetworkPoolIdentityProjection</code>. Added <code>{{nonce}}</code> helper to handlebars tab providers for injecting javascript safely within the Content Security Policies in place.</p>
</li>
<li>
<p><strong>0.12.3</strong> - Simplification and Polish if IPAM/DNS Interface Implementations (need Morpheus 5.4.4+). Added new ReportProvider helper for easier management of db connection use <code>withDbConnection { connection &#8594; }</code>.</p>
</li>
<li>
<p><strong>0.12.0</strong> - Cloud Provider Plugin Critical Fixes (WIP). Added Plugin settings.</p>
</li>
<li>
<p><strong>0.11.0</strong> - Cloud Provider Plugin Support. UI Nonce token attribute added for injecting javascript securely and css. Network Provider Plugin support. Create providers for dynamically creating networks and network related objects.</p>
</li>
<li>
<p><strong>0.10.0</strong> - Custom Report Type Providers have been added.</p>
</li>
<li>
<p><strong>0.8.0</strong> - Overhauled DNS/IPAM Integrations, Reorganized contexts and standardized formats. Added utility classes for easier sync logic. Custom reports, Cloud Providers, Server Tabs, and more. Only compatible with Morpheus version <code>5.3.1</code> forward.</p>
</li>
<li>
<p><strong>0.7.0</strong> - Please note due to jcenter() EOL Don&#8217;t use 0.7.0</p>
</li>
<li>
<p><strong>0.6.0</strong> - Primary Plugin target base version for 5.2.x Morpheus Releases</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="getting-started">Getting Started</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Developing plugins for Morpheus is a bit different than simply creating custom tasks or custom library items in Morpheus. It requires some programming experience. We should preface with the fact that Morpheus runs on top of Java. It is primarily written in a dynamic language called <a href="https://groovy-lang.org">Groovy</a> and is based on Groovy version 3.0.7 currently running within Java 11 (openjdk). The provided plugin api dependency provides a common set of interfaces a developer can implement to dynamically load functionality into the product. These developers are free to develop plugins in native Java or leverage the groovy runtime. Most examples provided are developed and sampled in groovy. It is a great dynamic language that is much less verbose and easier to understand than native java based languages. Plans for supporting additional languages are in the works. Most notably kotlin is being looked into as an alternative development platform. jRuby is also a viable language that can be used as the runtime is included with Morpheus. The plugin architecture is designed based on reactive models using <code>rxJava2</code>. This library follows <a href="http://reactivex.io/">ReactiveX</a> models for Observer pattern based programming. One unique thing about Observer pattern programming is to remember when writing a call to an <code>Observable</code> the code is not executed until the final <code>subscribe</code> call. If this call is missing, the code will never execute.</p>
</div>
<div class="paragraph">
<p><strong>NOTE:</strong> <code>rxJava3</code> is a different project build and cannot be used yet in place of <code>rxJava2</code>.</p>
</div>
<div class="paragraph">
<p>The plugin pipeline leverages <a href="https://gradle.org">Gradle</a> as the build tooling. Gradle is a cross-platform programmatic build tool that is very commonly used and is most notably also used in the android space. To begin make sure your development environment has Gradle 6.5 (at least but if using newer Gradle make sure you are familiar with the definition changes needed) as well as Java 11 (if using openjdk over 11 make sure target compatibility is set to 1.11 within your project).</p>
</div>
<div class="paragraph">
<p>The <a href="https://github.com/gomorpheus/morpheus-plugin-core">morpheus-plugin-core</a> git repository is structured such that sample plugins exist underneath the <code>samples</code> directory. They are part of a multi-project gradle project as can be defined in the root directories <code>settings.gradle</code>. This adds a bit of complexity and should be ignored when developing ones own plugin. Simply start with a blank project folder and a simple <code>build.gradle</code> as demonstrated below.</p>
</div>
<div class="paragraph">
<p>The structure of a Plugin is a typical "fat jar" (aka shadowJar). The plugin will include <code>morpheus-plugin-api</code> along with all the dependencies required to run. Though not required, it is often conventional to use the groovy programming language when developing plugins as can be seen in the samples. Morpheus is based on the groovy runtime and therefore allows full use of groovy 3.0.x.</p>
</div>
<div class="paragraph">
<p>The Structure of a project often starts with a gradle build along with a <code>Plugin</code> class implementation and a manifest that points to this class. This is the entrypoint for the plugin where all metadata about the plugin is defined as well as all <code>Providers</code> offered by the plugin are registered.</p>
</div>
<div class="sect2">
<h3 id="gradle-project">Gradle project</h3>
<div class="paragraph">
<p>Create a new project with a <code>build.gradle</code> file. We will use the shadowjar plugin to create our "fat jar"</p>
</div>
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">plugins {
    id <span class="string"><span class="delimiter">&quot;</span><span class="content">com.bertramlabs.asset-pipeline</span><span class="delimiter">&quot;</span></span> version <span class="string"><span class="delimiter">&quot;</span><span class="content">3.4.4</span><span class="delimiter">&quot;</span></span>
    id <span class="string"><span class="delimiter">&quot;</span><span class="content">com.github.johnrengelman.shadow</span><span class="delimiter">&quot;</span></span> version <span class="string"><span class="delimiter">&quot;</span><span class="content">6.0.0</span><span class="delimiter">&quot;</span></span>
}

apply <span class="key">plugin</span>: <span class="string"><span class="delimiter">'</span><span class="content">java</span><span class="delimiter">'</span></span>
apply <span class="key">plugin</span>: <span class="string"><span class="delimiter">'</span><span class="content">groovy</span><span class="delimiter">'</span></span>
apply <span class="key">plugin</span>: <span class="string"><span class="delimiter">'</span><span class="content">maven-publish</span><span class="delimiter">'</span></span>

group = <span class="string"><span class="delimiter">'</span><span class="content">com.example</span><span class="delimiter">'</span></span>
version = <span class="string"><span class="delimiter">'</span><span class="content">1.0.0</span><span class="delimiter">'</span></span>

sourceCompatibility = <span class="string"><span class="delimiter">'</span><span class="content">1.11</span><span class="delimiter">'</span></span>
targetCompatibility = <span class="string"><span class="delimiter">'</span><span class="content">1.11</span><span class="delimiter">'</span></span>

ext.isReleaseVersion = !version.endsWith(<span class="string"><span class="delimiter">&quot;</span><span class="content">SNAPSHOT</span><span class="delimiter">&quot;</span></span>)

repositories {
    mavenCentral()
}

dependencies {
    compileOnly <span class="string"><span class="delimiter">'</span><span class="content">com.morpheusdata:morpheus-plugin-api:0.12.4</span><span class="delimiter">'</span></span> <span class="comment">//use 0.13.1 for 5.5.x</span>
    compileOnly <span class="string"><span class="delimiter">'</span><span class="content">org.codehaus.groovy:groovy-all:3.0.7</span><span class="delimiter">'</span></span>

    <span class="comment">/*
     When using custom libraries, use the gradle `implementation` directive
     instead of `compileOnly`.
     This will allow shadowJar to package the library into the resulting plugin and keep it
     isolated within the same classloader.
     */</span>
}

tasks.assemble.dependsOn tasks.shadowJar</code></pre>
</div>
</div>
<div class="paragraph">
<p>To let the Morpheus plugin manager know what class to load you must specify the class in jar&#8217;s manifest:</p>
</div>
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">jar {
    manifest {
        attributes(
            <span class="string"><span class="delimiter">'</span><span class="content">Plugin-Class</span><span class="delimiter">'</span></span>: <span class="string"><span class="delimiter">'</span><span class="content">com.example.MyPlugin</span><span class="delimiter">'</span></span>, <span class="comment">//Reference to Plugin class</span>
            <span class="string"><span class="delimiter">'</span><span class="content">Plugin-Version</span><span class="delimiter">'</span></span>: archiveVersion.get() <span class="comment">// Get version defined in gradle</span>
        )
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>When writing plugin code, it is important to note a typical groovy/java project folder structure</p>
</div>
<div class="listingblock">
<div class="title">ls -R</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">./
.gitignore
build.gradle
src/main/groovy/
src/main/resources/renderer/hbs/
src/test/groovy/
src/assets/images/
src/assets/javascript/
src/assets/stylesheets/</code></pre>
</div>
</div>
<div class="paragraph">
<p>Be sure to configure your <code>.gitignore</code> file to ignore the <code>build/</code> directory which appears after performing your first build.</p>
</div>
<div class="paragraph">
<p>Most of the folder structure can be self-explanatory if familiar with groovy/java. Project packages live within <code>src/main/groovy</code> and contain source files ending in <code>.groovy</code>. View resources are stored in the <code>src/main/resources</code> subfolder and vary depending on the view renderer of choice. While static assets like icons or custom javascript live within the <code>src/assets</code> folder. This is handled by the <a href="http://www.asset-pipeline.com">Asset Pipeline</a> plugin. View rendering and static assets will be covered in more detail later.</p>
</div>
<div class="paragraph">
<p>Building a project is as simple as calling</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">./gradlew shadowJar</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>NOTE:</strong> If the gradle wrapper does not yet exist, simply run <code>gradle wrapper</code> within the root of the project to generate the wrapper.</p>
</div>
<div class="paragraph">
<p>The resulting jar will exist, by default, in the <code>build/libs</code> directory of the project.</p>
</div>
</div>
<div class="sect2">
<h3 id="plugin-class">Plugin Class</h3>
<div class="paragraph">
<p>Following the example above, create your plugin class under <code>src/main/java/com/example/MyPlugin.java</code></p>
</div>
<div class="paragraph">
<p>Your plugin must extend the <code>com.morpheus.core.Plugin</code> class:</p>
</div>
<div class="listingblock">
<div class="title">MyPlugin.java</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">import</span> <span class="include">com.morpheus.core.Plugin</span>;

<span class="type">class</span> <span class="class">MyPlugin</span> <span class="directive">extends</span> Plugin {

        <span class="annotation">@Override</span>
        <span class="type">void</span> initialize() {
                <span class="local-variable">this</span>.setName(<span class="string"><span class="delimiter">&quot;</span><span class="content">My Custom Tabs Plugin</span><span class="delimiter">&quot;</span></span>);
                CustomTabProvider tabProvider = <span class="keyword">new</span> CustomTabProvider(<span class="local-variable">this</span>, morpheus);
                <span class="local-variable">this</span>.registerProvider(tabProvider);
        }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Here we see a basic plugin that initializes some metadata (the Plugin Name) and registers a custom tab provider.</p>
</div>
</div>
<div class="sect2">
<h3 id="registering-providers">Registering Providers</h3>
<div class="paragraph">
<p>A plugin may contain any number of Plugin Providers. A Plugin Provider contains the functionality of your plugin such as a Custom Tab, IPAM, Backup Provider, etc.</p>
</div>
<div class="paragraph">
<p>There are provided classes such as <code>TaskProvider</code>, <code>ProvisioningProvider</code>, <code>ApprovalProvider</code>, <code>ReportProvider</code>, <code>InstanceTabProvider</code>, <code>ServerTabProvider</code>, and others to get you started building your provider. For example the <code>InstanceTabProvider</code> provides a renderer, show method, and security checking method to make it easy to build your own custom tab on the instance page.</p>
</div>
<div class="paragraph">
<p>Providers are registered in your plugin during the <code>initialize()</code> method call within the <code>Plugin</code> class as can be seen in the <code>MyPlugin.java</code> sample seen above.</p>
</div>
</div>
<div class="sect2">
<h3 id="settings">Settings</h3>
<div class="paragraph">
<p>As of 0.8.0 Plugins can now have settings that can be applied globally after installing a plugin. Some users may use this to configure an integration to a third party service like Datadog, or affect how providers may behave based on some setting. These can be set after uploading a plugin in <code>Administration &#8594; Integrations &#8594; Plugins</code>.</p>
</div>
<div class="paragraph">
<p>Settings, much like any other form aspect of a plugin, can take advantage of <code>OptionType</code> and <code>OptionProvider</code> entities to configure how the options are presented to the user and what options are available to choose from.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">    <span class="type">class</span> <span class="class">MyPlugin</span> <span class="directive">extends</span> Plugin {
        <span class="comment">/**
         * Returns a list of {@link OptionType} settings for this plugin.
         * @return this list of settings
         */</span>
        <span class="directive">public</span> <span class="predefined-type">List</span>&lt;OptionType&gt; getSettings() { <span class="keyword">return</span> <span class="local-variable">this</span>.settings; }
    }</code></pre>
</div>
</div>
<div class="paragraph">
<p>Implementing the above getter method allows one to specify the form option-types of settings that could be saved by the user.</p>
</div>
<div class="paragraph">
<p>Fetching setting values for use in a provider can easily be accomplished via the <code>morpheusContext</code>. There is a method that returns a JSON String of the setting values that is up to the plugin developer to deserialize called <code>morpheusContext.getSettings(Plugin plugin)</code>. Simply pass the plugin class instance to it and an rxJava <code>Single&lt;String&gt;</code> is returned.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="predefined-type">String</span> pluginSettings = morpheus.getSettings(<span class="local-variable">this</span>.plugin).blockingGet()
<span class="keyword">def</span> pluginDeserialized = <span class="keyword">new</span> JsonSlurper().parseText(pluginSettings)</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="contexts-services">Contexts / Services</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The Morpheus context allows you to interact with, query and save data with Morpheus. It is organized into several sub service classes to perform operations that may involve database calls or calling common methods within the Morpheus core that are not available directly. Some calls may be as simple as <code>listById</code> or <code>save</code>. But they can also be as complex as <code>executeSshCommand</code> or <code>executeWinrmCommand</code>. All calls within a Morpheus Context implement RxJava2 conventions. For details on how to program in Reactive syntax and RxJava concepts please see the documentation site <a href="http://reactivex.io/" class="bare">http://reactivex.io/</a>.</p>
</div>
<div class="paragraph">
<p>When interacting with various subcontexts it is helpful to know there is a common guideline on method names involving database calls. These common method names include:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>listIdentityProjections</code></p>
</li>
<li>
<p><code>listById</code></p>
</li>
<li>
<p><code>listBy*</code></p>
</li>
<li>
<p><code>get</code></p>
</li>
<li>
<p><code>findBy*</code></p>
</li>
<li>
<p><code>remove</code></p>
</li>
<li>
<p><code>create</code></p>
</li>
<li>
<p><code>save</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>There are, of course, exceptions and non ORM related methods that also may exist in certain services that provide common helper methods. For a full listing of the various service classes please check the API Docs and look at the <a href="https://developer.morpheusdata.com/api/com/morpheusdata/core/MorpheusContext.html">MorpheusContext</a> class. There are several in line with general ORM calls as well as some related to certain actions.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="models">Models</h2>
<div class="sectionbody">
<div class="paragraph">
<p>When interacting with Morpheus you must use the models provided in <code>com.morpheusdata.model.*</code>. This allows for the context to be strongly typed. These Models have a few conventions that you might like to know about. Firstly, models that are often synced from a cloud provider or integration of any kind often inherit from their base class known as an <code>IdentityProjection</code> which also inherits from <code>MorpheusModel</code>.</p>
</div>
<div class="paragraph">
<p><strong>For Example:</strong> the <code>NetworkDomain</code> model inherits <code>NetworkDomainIdentityProjection</code> which in turn inherits <code>MorpheusModel</code>.</p>
</div>
<div class="paragraph">
<p>The <code>IdentityProjection</code> contains a subset of properties that are typically used to match the object with its equivalent on the other side of an Api implementation. This is typically persisted in the <code>externalId</code> property of the object. Some objects also leverage <code>uniqueId</code> as well.</p>
</div>
<div class="paragraph">
<p>It is also recommended to use the getter and setter methods on the Models (which should be strictly required in the near future) so as to ensure the dirtyProperties map is updated appropriately. This will be used in future distributed worker installations to reduce bandwidth in transmission of data updates back to Morpheus.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="http-routing">HTTP Routing</h2>
<div class="sectionbody">
<div class="paragraph">
<p>A plugin may register an endpoint or endpoints to respond with <code>html</code> or <code>json</code>. To register your routes in your plugin you must implement the <code>PluginController</code> class.</p>
</div>
<div class="sect2">
<h3 id="models-2">Models</h3>
<div class="paragraph">
<p>Incoming requests come with a <code>ViewModel</code> object populated with the http request &amp; response details.</p>
</div>
</div>
<div class="sect2">
<h3 id="example">Example</h3>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">MyPluginController</span> <span class="directive">implements</span> PluginController {
        <span class="predefined-type">List</span>&lt;Route&gt; getRoutes() {
                [
                        Route.build(<span class="string"><span class="delimiter">&quot;</span><span class="content">/myPrefix/example</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">html</span><span class="delimiter">&quot;</span></span>, <span class="predefined-type">Permission</span>.build(<span class="string"><span class="delimiter">&quot;</span><span class="content">admin</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">full</span><span class="delimiter">&quot;</span></span>)),
                        Route.build(<span class="string"><span class="delimiter">&quot;</span><span class="content">/reverseTask/json</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">json</span><span class="delimiter">&quot;</span></span>, <span class="predefined-type">Permission</span>.build(<span class="string"><span class="delimiter">&quot;</span><span class="content">admin</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">full</span><span class="delimiter">&quot;</span></span>))
                ]
        }

        <span class="keyword">def</span> <span class="function">html</span>(ViewModel&lt;<span class="predefined-type">String</span>&gt; model) {
                <span class="keyword">return</span> HTMLResponse.success(<span class="string"><span class="delimiter">&quot;</span><span class="content">Some Text</span><span class="delimiter">&quot;</span></span>)
        }

        <span class="keyword">def</span> <span class="function">json</span>(ViewModel&lt;<span class="predefined-type">Map</span>&gt; model) {
                <span class="predefined-type">Map</span> simpleMap = [<span class="key">serverid</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">abc-123</span><span class="delimiter">&quot;</span></span>, <span class="key">other</span>: model.object.someData]
                <span class="keyword">return</span> JsonResponse.of(simpleMap)
        }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Route provides a builder to allow your plugin to easily build a route with permissions. It takes the <code>url</code>, the <code>method</code> in this class to call, and a list of <code>permissions</code> which can be built with the <code>Permission</code> builder.</p>
</div>
<div class="paragraph">
<p>The route can either return:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>HTMLResponse</code> - simple text, or a full rendered view.</p>
</li>
<li>
<p><code>JsonResponse</code> - an object rendered as json.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>After creating a <code>PluginController</code>, register it in your plugin like so:</p>
</div>
<div class="listingblock">
<div class="title">MyPlugin.java</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">        <span class="annotation">@Override</span>
        <span class="type">void</span> initialize() {
                <span class="local-variable">this</span>.setName(<span class="string"><span class="delimiter">&quot;</span><span class="content">My Custom Task Plugin</span><span class="delimiter">&quot;</span></span>);
                CustomTaskProvider taskProvider = <span class="keyword">new</span> CustomTaskProvider(<span class="local-variable">this</span>, morpheusContext);
                <span class="local-variable">this</span>.pluginProviders.put(taskProvider.providerCode, taskProvider);

                <span class="local-variable">this</span>.controllers.add(<span class="keyword">new</span> MyPluginController());
        }</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="http-api-client">HTTP API Client</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The <code>morpheus-plugin-api</code> library comes with a utility for facilitating quick and easy API calls to external integrations. This is called teh <code>HttpApiClient</code> and replaces the use of the <code>RestApiUtil</code>.</p>
</div>
<div class="paragraph">
<p>The developer is, of course, able to utilize any HTTP or SDK/API client they choose within the java ecosystem if so desired. However, this client provides some common functions such as SSL Validation, Throttling, Keep-Alive, Etc. and is based on the Apache HTTP Client.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
Reuse the same client instance when dealing with periodic refresh methods related to caching for best performance. Be mindful that throttling might be necessary to slow down the calls to the service.
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="example-2">Example</h3>
<div class="paragraph">
<p>Below is an example API Call taken from the <code>Infoblox</code> plugin.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">import</span> <span class="include">com.morpheusdata.core.util.HttpApiClient</span>

HttpApiClient infobloxClient = <span class="keyword">new</span> HttpApiClient()
<span class="keyword">try</span> {
    <span class="keyword">def</span> results = infobloxClient.callJsonApi(serviceUrl, apiPath, poolServer.serviceUsername, poolServer.servicePassword, <span class="keyword">new</span> HttpApiClient.RequestOptions(<span class="key">headers</span>:[<span class="string"><span class="delimiter">'</span><span class="content">Content-Type</span><span class="delimiter">'</span></span>:<span class="string"><span class="delimiter">'</span><span class="content">application/json</span><span class="delimiter">'</span></span>],
                                                                                                                    <span class="key">queryParams</span>:pageQuery, <span class="key">ignoreSSL</span>: poolServer.ignoreSsl), <span class="string"><span class="delimiter">'</span><span class="content">GET</span><span class="delimiter">'</span></span>)
} <span class="keyword">catch</span>(e) {
    log.error(<span class="string"><span class="delimiter">&quot;</span><span class="content">verifyPoolServer error: </span><span class="inline"><span class="inline-delimiter">${</span>e<span class="inline-delimiter">}</span></span><span class="delimiter">&quot;</span></span>, e)
} <span class="keyword">finally</span> {
    infobloxClient.shutdownClient()
}
<span class="keyword">return</span> rtn</code></pre>
</div>
</div>
<div class="paragraph">
<p>There are several methods to call the api and automatically handle certain payload formats such as <code>callJsonApi</code>, <code>callXmlApi</code>, or plain <code>callApi</code>.</p>
</div>
<div class="paragraph">
<p>Options can be passed relating to the request via the <code>HttpApiClient.RequestOptions</code> object. Please refer to the java api doc for available options.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
Remember to always shutdown the client after it is used to clean up the connection manager in a <code>try{} finally{}</code> type block
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="views">Views</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Plugins may render html sections such as adding a tab to different areas of Morpheus which you can populate with your own content. By default a Handlebars template provider is provided by the Plugin Manager. If you wish to use your own template engine you may implement <code>com.morpheusdata.views.Renderer</code> interface.</p>
</div>
<div class="sect2">
<h3 id="rendering-a-view">Rendering a view</h3>
<div class="paragraph">
<p>Views are stored in your plugin at <code>src/main/resources/renderer/&lt;plugin scope&gt;/&lt;your view&gt;.hbs</code>. Many plugin providers provide a convention to store views that will be rendered.</p>
</div>
<div class="paragraph">
<p>If you wish to render and return html manually you can call the renderer directly:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">getRenderer().renderTemplate(<span class="string"><span class="delimiter">&quot;</span><span class="content">prefix/someview</span><span class="delimiter">&quot;</span></span>, model);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Do not provide the suffix (.hbs) - you may also pass a <code>com.morpheusdata.views.ViewModel</code> into the view to use when rendering the html.</p>
</div>
</div>
<div class="sect2">
<h3 id="asset-helper">Asset helper</h3>
<div class="paragraph">
<p>The template engine can also process static assets such as images, css, and javascript for you. Place your assets under <code>src/assets/{plugin-code}</code>.
To include them in the plugin template you can use the <code>{{ asset }}</code> handlebars helper as so:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="html"><span class="tag">&lt;script</span> <span class="attribute-name">src</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">{{asset </span><span class="delimiter">&quot;</span></span><span class="error">/</span><span class="attribute-name">instance-tab.js</span><span class="error">&quot;</span><span class="error">}</span><span class="error">}</span><span class="error">&quot;</span><span class="tag">&gt;</span><span class="tag">&lt;/script&gt;</span>
<span class="tag">&lt;img</span> <span class="attribute-name">src</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">{{asset </span><span class="delimiter">&quot;</span></span><span class="error">/</span><span class="attribute-name">some</span><span class="error">/</span><span class="attribute-name">image.png</span><span class="error">&quot;</span><span class="error">}</span><span class="error">}</span><span class="error">&quot;</span> <span class="tag">/&gt;</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="option-sources">Option Sources</h2>
<div class="sectionbody">
<div class="paragraph">
<p>An Option source is a server side call to load a dynamic dataset for custom form inputs. These normally feed dropdown lists, multiselect components, and typeahead components. These can be very useful when designing task types that have custom options or even custom catalog item layouts.</p>
</div>
<div class="sect2">
<h3 id="getting-started-2">Getting Started</h3>
<div class="paragraph">
<p>To get started, simply create an implementation of an <code>OptionSourceProvider</code>. The primary implementation method is called <code>getMethodNames</code> and just returns a list of methods on the class that are accessed via API as datasets.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">GoogleOptionSourceProvider</span> <span class="directive">implements</span> OptionSourceProvider {
<span class="annotation">@Override</span>
    <span class="predefined-type">List</span>&lt;<span class="predefined-type">String</span>&gt; getMethodNames() {
        <span class="keyword">return</span> <span class="keyword">new</span> <span class="predefined-type">ArrayList</span>&lt;<span class="predefined-type">String</span>&gt;([<span class="string"><span class="delimiter">'</span><span class="content">googlePluginProjects</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">googlePluginRegions</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">googlePluginZonePools</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">googlePluginMtu</span><span class="delimiter">'</span></span>])
    }

    <span class="keyword">def</span> <span class="function">googlePluginProjects</span>(args) {
        <span class="predefined-type">Map</span> authConfig = getAuthConfig(args)
        <span class="keyword">def</span> projectResults = <span class="type">[]</span>
        <span class="keyword">if</span>(authConfig.clientEmail &amp;&amp; authConfig.privateKey) {
            <span class="keyword">def</span> listResults = GoogleApiService.listProjects(authConfig)
            <span class="keyword">if</span>(listResults.success) {
                projectResults = listResults.projects?.collect { [<span class="key">name</span>: <span class="local-variable">it</span>.name, <span class="key">value</span>: <span class="local-variable">it</span>.projectId] }
                projectResults = projectResults.sort { a, b -&gt; a.name?.toLowerCase() &lt;=&gt; b.name?.toLowerCase() }
            }
        }
        projectResults
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Above is an example option source registered for the Google Cloud Plugin. <strong>NOTE:</strong> Every method must have a singular input argument of type <code>Object</code> (which is the default in Groovy). In reality, it is a Map containing passed in params from the api call that can be referenced as well as the current user object. It is also worth noting that the return type expected is a <code>List&lt;Map&lt;String,String&gt;&gt;</code> whereby the properties on the map are of keys <code>name,value</code>.</p>
</div>
<div class="paragraph">
<p>Now, when defining your <code>OptionType</code> simply set your <code>optionSource</code> property to the field name defined in your provider. It is important not to conflict names with other plugins so please try to use a unique method name.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
Use a Unique Method name that will not interfere with other plugins the user may load.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">OptionType ot4 = <span class="keyword">new</span> OptionType(
                                <span class="key">name</span>: <span class="string"><span class="delimiter">'</span><span class="content">Region</span><span class="delimiter">'</span></span>,
                                <span class="key">code</span>: <span class="string"><span class="delimiter">'</span><span class="content">google-plugin-region</span><span class="delimiter">'</span></span>,
                                <span class="key">fieldName</span>: <span class="string"><span class="delimiter">'</span><span class="content">googleRegionId</span><span class="delimiter">'</span></span>,
                                <span class="key">optionSource</span>: <span class="string"><span class="delimiter">'</span><span class="content">googlePluginRegions</span><span class="delimiter">'</span></span>, <span class="comment">//Note the Option Source Defined here.</span>
                                <span class="key">displayOrder</span>: <span class="integer">3</span>,
                                <span class="key">fieldLabel</span>: <span class="string"><span class="delimiter">'</span><span class="content">Region</span><span class="delimiter">'</span></span>,
                                <span class="key">required</span>: <span class="predefined-constant">true</span>,
                                <span class="key">inputType</span>: OptionType.InputType.SELECT,
                                <span class="key">dependsOn</span>: <span class="string"><span class="delimiter">'</span><span class="content">google-plugin-project-id</span><span class="delimiter">'</span></span>,
                                <span class="key">fieldContext</span>: <span class="string"><span class="delimiter">'</span><span class="content">config</span><span class="delimiter">'</span></span>
                )</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="testing">Testing</h2>
<div class="sectionbody">
<div class="paragraph">
<p>We recommend <a href="http://spockframework.org/">Spock</a> for easily testing your plugin. The interfaces can easily be mocked and stubbed to allow you to test your integrations without a running Morpheus instance.</p>
</div>
<div class="sect2">
<h3 id="example-3">Example</h3>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">InfobloxProviderSpec</span> <span class="directive">extends</span> Specification {
    <span class="annotation">@Shared</span> MorpheusContext context
    <span class="annotation">@Shared</span> InfobloxPlugin plugin
    <span class="annotation">@Shared</span> InfobloxAPI infobloxAPI
    <span class="annotation">@Shared</span> MorpheusNetworkContext networkContext
    <span class="annotation">@Subject</span> <span class="annotation">@Shared</span> InfobloxProvider provider

    <span class="type">void</span> setup() {
        <span class="comment">// Create a Mocks of the Morepohus contexts you will use</span>
        context = Mock(MorpheusContextImpl)
        networkContext = Mock(MorpheusNetworkContext)
        context.getNetwork() &gt;&gt; networkContext
        plugin = Mock(InfobloxPlugin)
        infobloxAPI = Mock(InfobloxAPI)

        <span class="comment">// Create the actual provider to unit test</span>
        provider = <span class="keyword">new</span> InfobloxProvider(plugin, context, infobloxAPI)
    }

    <span class="type">void</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">listNetworks</span><span class="delimiter">&quot;</span></span>() {
        <span class="key">given</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">A pool server</span><span class="delimiter">&quot;</span></span>
        <span class="keyword">def</span> poolServer = <span class="keyword">new</span> NetworkPoolServer(<span class="key">apiPort</span>: <span class="integer">8080</span>, <span class="key">serviceUrl</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">http://localhost</span><span class="delimiter">&quot;</span></span>)
        <span class="comment">// Here we are stubbing the actual API call to infoblox, but we could create a integration test by actually providing the real infoblox API class instead of a mock.</span>
        infobloxAPI.callApi(_, _, _, _, _, _) &gt;&gt; <span class="keyword">new</span> ServiceResponse(<span class="key">success</span>: <span class="predefined-constant">true</span>, <span class="key">errors</span>: <span class="predefined-constant">null</span> , <span class="key">content</span>:<span class="string"><span class="delimiter">'</span><span class="content">{&quot;foo&quot;: 1}</span><span class="delimiter">'</span></span>)

        <span class="key">when</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">We list the networks</span><span class="delimiter">&quot;</span></span>
        <span class="keyword">def</span> response = provider.listNetworks(poolServer, [<span class="key">doPaging</span>: <span class="predefined-constant">false</span>])

        <span class="key">then</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">We get a response</span><span class="delimiter">&quot;</span></span>
        response.size() == <span class="integer">1</span>
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>As you can see, implementing unit and integration testing for your plugins can be done easily with Spock. Of course any other JVM unit testing framework should work as well.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="seeding-data-during-plugin-installation">Seeding data during plugin installation</h2>
<div class="sectionbody">
<div class="paragraph">
<p>If you need to ensure that certain data (e.g. layouts, plans, etc.) is added to the database when your plugin is installed, you can use this process to "seed" that data.</p>
</div>
<div class="paragraph">
<p>You will need to create a folder called <strong>seed</strong> in your your plugin&#8217;s resources folder ('src/main/resources/seed'). Then add YAML seed files to that folder. We recommend descriptive names like <em>Ubuntu22Seeds.yaml</em>. The seed files should be modeled off of plugin database model classes (see examples below). All new seeds and updates to existing seeds will be processed when your plugin is installed or reloaded.</p>
</div>
<div class="sect2">
<h3 id="example-4">Example</h3>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="comment"># seed entries</span>
<span class="key">seed</span>:
  <span class="key">optionType</span>:
  - <span class="string"><span class="content">meta:</span><span class="content">
      key: code</span></span>
    <span class="key">code</span>: <span class="string"><span class="content">demo-option-1</span></span>
    <span class="key">name</span>: <span class="string"><span class="content">Demo Option 1</span></span>
    <span class="key">type</span>: <span class="string"><span class="content">text</span></span>
    <span class="key">fieldClass</span>: <span class="string"><span class="content">input-tall</span></span>
    <span class="key">fieldLabel</span>: <span class="string"><span class="content">Demo Option 1</span></span>
    <span class="key">fieldName</span>: <span class="string"><span class="content">demoOption1</span></span>
    <span class="key">fieldGroup</span>: <span class="string"><span class="content">Demo Config</span></span>
    <span class="key">fieldContext</span>: <span class="string"><span class="content">config</span></span>
    <span class="key">displayOrder</span>: <span class="string"><span class="content">10</span></span>
  - <span class="string"><span class="content">meta:</span><span class="content">
      key: code</span></span>
    <span class="key">code</span>: <span class="string"><span class="content">demo-option-2</span></span>
    <span class="key">name</span>: <span class="string"><span class="content">Demo Option 2</span></span>
    <span class="key">type</span>: <span class="string"><span class="content">password</span></span>
    <span class="key">fieldLabel</span>: <span class="string"><span class="content">Demo Option</span></span>
    <span class="key">fieldName</span>: <span class="string"><span class="content">demoOption2</span></span>
    <span class="key">fieldGroup</span>: <span class="string"><span class="content">Demo Config</span></span>
    <span class="key">fieldContext</span>: <span class="string"><span class="content">config</span></span>
    <span class="key">displayOrder</span>: <span class="string"><span class="content">20</span></span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="examples">Examples</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="task-plugin">Task Plugin</h3>
<div class="paragraph">
<p>Add custom Tasks types to Morpheus. See a <a href="https://github.com/gomorpheus/morpheus-plugin-core/tree/master/samples/morpheus-task-plugin">full example</a>.</p>
</div>
<div class="sect3">
<h4 id="setup">Setup</h4>
<div class="paragraph">
<p>Tasks are useful components of your provisioning workflow.
This plugin allows you to create custom Tasks</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Create a new class that implements <code>com.morpheusdata.core.TaskProvider</code></p>
</li>
<li>
<p>Create a new class that extends <code>com.morpheusdata.core.AbstractTaskService</code>.
This service defines methods for task execution in a variety of contexts, described below.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="options">Options</h4>
<div class="paragraph">
<p><code>OptionType</code> is an easy way to create configuration for your new Task.
Simply provide a list of <code>com.morpheusdata.model.OptionType</code> to the <code>TaskProvider.getOptionTypes</code> method.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">        <span class="annotation">@Override</span>
        <span class="predefined-type">List</span>&lt;OptionType&gt; getOptionTypes() {
                OptionType optionType = <span class="keyword">new</span> OptionType(
                                <span class="key">name</span>: <span class="string"><span class="delimiter">'</span><span class="content">myTask</span><span class="delimiter">'</span></span>,
                                <span class="key">code</span>: <span class="string"><span class="delimiter">'</span><span class="content">myTaskText</span><span class="delimiter">'</span></span>,
                                <span class="key">fieldName</span>: <span class="string"><span class="delimiter">'</span><span class="content">myTask</span><span class="delimiter">'</span></span>,
                                <span class="key">optionSource</span>: <span class="predefined-constant">true</span>,
                                <span class="key">displayOrder</span>: <span class="integer">0</span>,
                                <span class="key">fieldLabel</span>: <span class="string"><span class="delimiter">'</span><span class="content">Text to Reverse</span><span class="delimiter">'</span></span>,
                                <span class="key">required</span>: <span class="predefined-constant">true</span>,
                                <span class="key">inputType</span>: OptionType.InputType.TEXT
                )
                <span class="keyword">return</span> [optionType]
        }</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="task-contexts">Task Contexts</h4>
<div class="paragraph">
<p>A task can be run in one of three contexts:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>None/Local (<code>executeLocalTask</code>)</p>
</li>
<li>
<p>Remote (<code>executeRemoteTask</code>)</p>
</li>
<li>
<p>Instance (<code>executeContainerTask</code>, <code>executeContainerTask</code>)</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="task-logo">Task Logo</h4>
<div class="paragraph">
<p>A custom logo can be used in the Morpheus UI by placing an image at <code>src/assets/images/{task-code}.png</code>.
Recommended file size is 180 x 60 px.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="ui-extensions">UI Extensions</h3>
<div class="paragraph">
<p>Morpheus UI Extension Plugins provide a way to expand the capabilityies of the Morpheus UI. Render custom content as a tab on an Instance, or even on a Server. Create a global injection component to the main layout footer for support/chat services. The possibilities are growing with each release and new functionality since 0.8.0 brings a lot.  <a href="https://github.com/gomorpheus/morpheus-plugin-core/tree/master/samples/morpheus-tab-plugin">See a full tabs example</a>.</p>
</div>
<div class="sect3">
<h4 id="setup-instance-tabs">Setup Instance Tabs</h4>
<div class="paragraph">
<p>Create a new class that extends <code>com.morpheusdata.core.AbstractInstanceTabProvider</code>. When the Morpheus UI builds the Instance UI it calls the <code>renderTemplate</code> method.
Below is a simple example binding the Instance object to the template model.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="annotation">@Override</span>
HTMLResponse renderTemplate(Instance instance) {
  ViewModel&lt;Instance&gt; model = <span class="keyword">new</span> ViewModel&lt;&gt;()
  model.object = instance
  getRenderer().renderTemplate(<span class="string"><span class="delimiter">&quot;</span><span class="content">hbs/instanceTab</span><span class="delimiter">&quot;</span></span>, model)
}</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
Use <code>MorpheusContext.buildInstanceConfig</code> to get more details about your Instance. See <code>com.morpheusdata.model.TaskConfig</code>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><a href="https://github.com/jknack/handlebars.java">Handlebars</a> is the default provided template engine.
To override this default, implement the <code>com.morpheusdata.core.InstanceTabProvider</code> interface and then write
your own <code>getRenderer()</code> method.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
The <code>HandlebersRenderer</code> provides a helper called <code>{{nonce}}</code> for injecting into script tags
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="setup-server-tabs">Setup Server Tabs</h4>
<div class="paragraph">
<p>Create a new class that extends <code>com.morpheusdata.core.AbstractServerTabProvider</code>. When the Morpheus UI builds the Server Details UI, it calls the <code>renderTemplate</code> method.
Below is a simple example binding the Instance object to the template model.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="annotation">@Override</span>
HTMLResponse renderTemplate(ComputeServer server) {
  ViewModel&lt;ComputeServer&gt; model = <span class="keyword">new</span> ViewModel&lt;&gt;()
  model.object = server
  getRenderer().renderTemplate(<span class="string"><span class="delimiter">&quot;</span><span class="content">hbs/serverTab</span><span class="delimiter">&quot;</span></span>, model)
}</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
Use <code>MorpheusContext.buildComputeServerConfig</code> to get more details about your Server. See <code>com.morpheusdata.model.TaskConfig</code>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><a href="https://github.com/jknack/handlebars.java">Handlebars</a> is the default provided template engine.
To override this default, implement the <code>com.morpheusdata.core.ServerTabProvider</code> interface and then write
your own <code>getRenderer()</code> method.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="templating">Templating</h3>
<div class="paragraph">
<p>See the <a href="#views">Views</a> section and the documentation for your templating engine for specific syntax.</p>
</div>
<div class="sect3">
<h4 id="security-policies">Security Policies</h4>
<div class="sect4">
<h5 id="user-permissions">User Permissions</h5>
<div class="paragraph">
<p>Before a template is rendered in the UI, the <code>InstanceTabProvider.show</code> method is called to determine if the current user can view the custom Instance Tab.
For example, you may wish to check that the current <code>User</code> has been granted the custom permission defined by your plugin.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="annotation">@Override</span>
<span class="predefined-type">Boolean</span> show(Instance instance, User user, Account account) {
  <span class="keyword">def</span> show = <span class="predefined-constant">true</span>
  plugin.permissions.each { <span class="predefined-type">Permission</span> permission -&gt;
    <span class="keyword">if</span>(user.permissions[permission.code] != permission.availableAccessTypes.last().toString()){
      show = <span class="predefined-constant">false</span>
    }
  }
  <span class="keyword">return</span> show
}</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="content-security-policy">Content Security Policy</h5>
<div class="paragraph">
<p>If your custom UI needs to include external resources such as scripts, stylesheets, or frames,
you may need to customize the Morpheus <code>Content-Security-Policy</code> Header to allow those elements to be loaded in the browser.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="annotation">@Override</span>
TabContentSecurityPolicy getContentSecurityPolicy() {
  <span class="keyword">def</span> csp = <span class="keyword">new</span> TabContentSecurityPolicy()
  csp.scriptSrc = <span class="string"><span class="delimiter">'</span><span class="content">*.jsdelivr.net</span><span class="delimiter">'</span></span>
  csp.frameSrc = <span class="string"><span class="delimiter">'</span><span class="content">*.digitalocean.com</span><span class="delimiter">'</span></span>
  csp.imgSrc = <span class="string"><span class="delimiter">'</span><span class="content">*.wikimedia.org</span><span class="delimiter">'</span></span>
  csp.styleSrc = <span class="string"><span class="delimiter">'</span><span class="content">https: *.bootstrapcdn.com</span><span class="delimiter">'</span></span>
  csp
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can also use the per request <code>nonce</code> token to set the attribute on the <code>&lt;script/&gt;</code> tags you may be injecting:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="handlebars">&lt;script src=&quot;blah.js&quot; nonce=&quot;{{nonce}}&quot;/&gt;</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="catalog-layouts-plugin">Catalog Layouts Plugin</h3>
<div class="paragraph">
<p>It is becoming popular for some enterprises and managed service providers to expose simpler options when it comes to provisioning workloads. These could be used to target employees who are not highly technical or to further restrict what someone is allowed to order. Not only can they provision workloads like vms, and containers, but also execute operational tasks created by the administrator. Sometimes, it is necessary to further customize how a catalog detail page looks. There may be special ways of displaying information, or even the order form components need some advanced customization.</p>
</div>
<div class="paragraph">
<p>This plugin exposes the ability to control everything from the HTML used to render the catalog item, to the javascript that controls the form options. By default, we use a server-side handlebars template renderer however this can be completely customized if so desired.</p>
</div>
<div class="sect3">
<h4 id="setup-2">Setup</h4>
<div class="paragraph">
<p>Given the advanced nature of this plugin, it may be best to start with the sample plugin provided in the main project repository called <code>samples/morpheus-standard-catalog-layout-plugin</code>. This plugin replicates the embedded layout functionality so acts as a great starting point. It even includes the javascript used for rendering the option types within it.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
Reference the Sample Catalog Layout Plugin before making your own.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The core of the plugin starts with the <code>CatalogItemLayoutProvider</code> which extends the common <code>UIProvider</code>. Most of the UI related plugin types have some commonalities. The primary difference is the command line arguments sent to the <code>render()</code> method.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="comment">/**
 * Example TabProvider
 */</span>
<span class="type">class</span> <span class="class">StandardCatalogLayoutProvider</span> <span class="directive">extends</span> AbstractCatalogItemLayoutProvider {
        Plugin plugin
        MorpheusContext morpheus

        <span class="predefined-type">String</span> code = <span class="string"><span class="delimiter">'</span><span class="content">catalog-item-standard</span><span class="delimiter">'</span></span>
        <span class="predefined-type">String</span> name = <span class="string"><span class="delimiter">'</span><span class="content">Standard Catalog Layout</span><span class="delimiter">'</span></span>

        StandardCatalogLayoutProvider(Plugin plugin, MorpheusContext context) {
                <span class="local-variable">this</span>.plugin = plugin
                <span class="local-variable">this</span>.morpheus = context
        }

    <span class="comment">/**
     * Demonstrates building a TaskConfig to get details about the Server and renders the html from the specified template.
     * @param server details of a ComputeServer
     * @return
     */</span>
        <span class="annotation">@Override</span>
    HTMLResponse renderTemplate(CatalogItemType catalogItemType, User user) {
        ViewModel&lt;CatalogItemType&gt; model = <span class="keyword">new</span> ViewModel&lt;&gt;()
        model.object = catalogItemType
        getRenderer().renderTemplate(<span class="string"><span class="delimiter">&quot;</span><span class="content">hbs/standardCatalogItem</span><span class="delimiter">&quot;</span></span>, model)
    }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The render method allows the <code>CatalogItemType</code> model to be passed into a handlebars view for rendering.</p>
</div>
<div class="paragraph">
<p>The handlebars template, in this case, takes over the rendering of the entire page below the main navigation. It allows inclusion of external assets as well as assets included in the project via <code>asset-pipeline</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="html"><span class="tag">&lt;script</span> <span class="attribute-name">src</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">{{asset </span><span class="delimiter">&quot;</span></span><span class="error">/</span><span class="attribute-name">form_manager.js</span><span class="error">&quot;</span><span class="error">}</span><span class="error">}</span><span class="error">&quot;</span> <span class="tag">&gt;</span><span class="tag">&lt;/script&gt;</span>
<span class="tag">&lt;link</span> <span class="attribute-name">rel</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">stylesheet</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">text/css</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">href</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">{{asset </span><span class="delimiter">&quot;</span></span><span class="error">/</span><span class="attribute-name">styles.css</span><span class="error">&quot;</span><span class="error">}</span><span class="error">}</span><span class="error">&quot;</span><span class="tag">&gt;</span>
<span class="tag">&lt;script</span> <span class="attribute-name">src</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">{{asset </span><span class="delimiter">&quot;</span></span><span class="error">/</span><span class="attribute-name">templates</span><span class="error">/</span><span class="attribute-name">plugin-configurable-option.js</span><span class="error">&quot;</span><span class="error">}</span><span class="error">}</span><span class="error">&quot;</span> <span class="tag">&gt;</span><span class="tag">&lt;/script&gt;</span>
<span class="tag">&lt;div</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">page-content</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;div</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">catalog-item-details</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
                <span class="tag">&lt;div</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">item-type-header</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
                        <span class="tag">&lt;div</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">item-type-image</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
                                <span class="tag">&lt;img</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">item-header-img</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">src</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">{{catalogTypeImage}}</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">title</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">{{name}}</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">onError</span>=<span class="string"><span class="delimiter">&quot;</span>loadImage(<span class="local-variable">this</span>);<span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
                        <span class="tag">&lt;/div&gt;</span>
                        <span class="tag">&lt;h1</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">ellipsize</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">title</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">{{name}}</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>{{name}}<span class="tag">&lt;/h1&gt;</span>
                        <span class="tag">&lt;div</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">desc</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>{{description}}<span class="tag">&lt;/div&gt;</span>
                <span class="tag">&lt;/div&gt;</span>
                <span class="tag">&lt;div</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">catalog-item-body break-container-sm</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
                        {{#hasWiki}}
                                <span class="tag">&lt;div</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">catalog-item-content wiki-content</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
                                        {{wiki}}
                                <span class="tag">&lt;/div&gt;</span>
                        {{/hasWiki}}
                        <span class="tag">&lt;div</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">catalog-item-configuration {{#hasWiki}}with-item-content{{/hasWiki}}</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
                                {{#orderForm}}
                                        <span class="tag">&lt;div</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">actions text-right</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>

                                        <span class="tag">&lt;/div&gt;</span>
                                {{/orderForm}}
                        <span class="tag">&lt;/div&gt;</span>
                <span class="tag">&lt;/div&gt;</span>
        <span class="tag">&lt;/div&gt;</span>
<span class="tag">&lt;/div&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>NOTE:</strong> A couple helper methods are registered such as the <code>orderForm</code> block which injects the order form data into the html render.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
Pay special attention to the included javascript files used for rendering options. More often than not, one would want to copy these for use in a custom layout.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="consuming-the-plugin">Consuming the Plugin</h4>
<div class="paragraph">
<p>Once a Catalog Layout plugin is compiled and loaded into a Morpheus environment, the layout is automatically made available globally for use when creating a service catalog item in the <code>Blueprints</code> section. Simply edit the catalog item and a new dropdown showing available layouts should be available to choose.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="reports-plugin">Reports Plugin</h3>
<div class="paragraph">
<p>Create custom report types for users to consume within Morpheus. Customize the behavior of how the report data is assembled and generated as well as the way it is rendered/displayed to the user. See a <a href="https://github.com/gomorpheus/morpheus-plugin-core/tree/master/samples/morpheus-reports-plugin">full example</a>.</p>
</div>
<div class="sect3">
<h4 id="setup-3">Setup</h4>
<div class="paragraph">
<p>Creating a report is just a matter of registering a new implementation of a <code>ReportProvider</code>. If using standard handlebars rendering similar to UI Extensions, simply extend the <code>com.morpheusdata.core.AbstractReportProvider</code>. Before creating a report a few concepts should be made known.</p>
</div>
<div class="paragraph">
<p>There are a few model objects of importance. Firstly, the <code>ReportProvider</code> implementation always generates a <code>ReportType</code> for reference and display when the user is browsing a report ro run.</p>
</div>
<div class="paragraph">
<p>After a report is run a <code>ReportResult</code> is generated. This represents the information of who created the report as well as any submitted filters / report options related to the report. When creating a process method the results of the run should be stored as <code>ReportResultRow</code> objects. These have a <code>displayOrder</code> and <code>section</code>. This allows one to store header data as well as line item data for rendering and csv export. These rows are generated using rxjava asynchronous flows in the <code>process</code> method. Example Here:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">void</span> process(ReportResult reportResult) {
  morpheus.report.updateReportResultStatus(reportResult,ReportResult.Status.generating).blockingGet()
  <span class="predefined-type">Long</span> displayOrder = <span class="integer">0</span>
  <span class="predefined-type">List</span>&lt;GroovyRowResult&gt; results = <span class="type">[]</span>
  withDbConnection { <span class="predefined-type">Connection</span> dbConnection -&gt;
    <span class="keyword">if</span>(reportResult.configMap?.phrase) {
      <span class="predefined-type">String</span> phraseMatch = <span class="string"><span class="delimiter">&quot;</span><span class="inline"><span class="inline-delimiter">${</span>reportResult.configMap?.phrase<span class="inline-delimiter">}</span></span><span class="content">%</span><span class="delimiter">&quot;</span></span>
      results = <span class="keyword">new</span> Sql(dbConnection).rows(<span class="string"><span class="delimiter">&quot;</span><span class="content">SELECT id,name,status from instance WHERE name LIKE </span><span class="inline"><span class="inline-delimiter">${</span>phraseMatch<span class="inline-delimiter">}</span></span><span class="content"> order by name asc;</span><span class="delimiter">&quot;</span></span>)
    } <span class="keyword">else</span> {
      results = <span class="keyword">new</span> Sql(dbConnection).rows(<span class="string"><span class="delimiter">&quot;</span><span class="content">SELECT id,name,status from instance order by name asc;</span><span class="delimiter">&quot;</span></span>)
    }
  }

<span class="predefined-type">Observable</span>&lt;GroovyRowResult&gt; observable = <span class="predefined-type">Observable</span>.fromIterable(results) <span class="keyword">as</span> <span class="predefined-type">Observable</span>&lt;GroovyRowResult&gt;
  observable.map{ resultRow -&gt;
    <span class="predefined-type">Map</span>&lt;<span class="predefined-type">String</span>,<span class="predefined-type">Object</span>&gt; data = [<span class="key">name</span>: resultRow.name, <span class="key">id</span>: resultRow.id, <span class="key">status</span>: resultRow.status]
    ReportResultRow resultRowRecord = <span class="keyword">new</span> ReportResultRow(<span class="key">section</span>: ReportResultRow.SECTION_MAIN, <span class="key">displayOrder</span>: displayOrder++, <span class="key">dataMap</span>: data)
    <span class="keyword">return</span> resultRowRecord
  }.buffer(<span class="integer">50</span>).doOnComplete {
    morpheus.report.updateReportResultStatus(reportResult,ReportResult.Status.ready).blockingGet()
  }.doOnError { <span class="predefined-type">Throwable</span> t -&gt;
    morpheus.report.updateReportResultStatus(reportResult,ReportResult.Status.failed).blockingGet()
  }.subscribe {resultRows -&gt;
    morpheus.report.appendResultRows(reportResult,resultRows).blockingGet()
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>NOTE:</strong> Notice that this process method features the ability to get a read only database connection to the morpheus MySQL Database. This isn&#8217;t always the best option but is a good fallback option for grabbing data you may not otherwise be able to get. Other data query methods are available on the various <code>MorpheusContext</code> subService classes. Expect more of these to be filled out as the plugin ecosystem develops. A good example of this is the <code>MorpheusAccountInvoiceService</code> found via the <code>MorpheusCostingService</code>. It enables you to query all invoices just as you would from the api.</p>
</div>
</div>
<div class="sect3">
<h4 id="custom-filters">Custom Filters</h4>
<div class="paragraph">
<p>It is often the case that a user may want to adjust how a filter runs. Perhaps they want to reduce the result set to a filtered set of data or group by certain properties. For this, the <code>ReportProvider</code> provides a <code>getOptionTypes</code> method that when implemented allows the developer to specify custom form inputs the user has to select when running the report.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="annotation">@Override</span>
<span class="predefined-type">List</span>&lt;OptionType&gt; getOptionTypes() {
  [<span class="keyword">new</span> OptionType(<span class="key">code</span>: <span class="string"><span class="delimiter">'</span><span class="content">status-report-search</span><span class="delimiter">'</span></span>, <span class="key">name</span>: <span class="string"><span class="delimiter">'</span><span class="content">Search</span><span class="delimiter">'</span></span>, <span class="key">fieldName</span>: <span class="string"><span class="delimiter">'</span><span class="content">phrase</span><span class="delimiter">'</span></span>, <span class="key">fieldContext</span>: <span class="string"><span class="delimiter">'</span><span class="content">config</span><span class="delimiter">'</span></span>, <span class="key">fieldLabel</span>: <span class="string"><span class="delimiter">'</span><span class="content">Search Phrase</span><span class="delimiter">'</span></span>, <span class="key">displayOrder</span>: <span class="integer">0</span>)]
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>It is important to note the <code>fieldContext</code> should almost always be set to <code>config</code> in this instance.</p>
</div>
</div>
<div class="sect3">
<h4 id="rendering">Rendering</h4>
<div class="paragraph">
<p>Render is very similar to rendering a tab. The main difference is the payload that is sent for the render is the <code>ReportResult</code> representing the particular report run as well as the dataset rows grouped by section.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="annotation">@Override</span>
HTMLResponse renderTemplate(ReportResult reportResult, <span class="predefined-type">Map</span>&lt;<span class="predefined-type">String</span>, <span class="predefined-type">List</span>&lt;ReportResultRow&gt;&gt; reportRowsBySection) {
    ViewModel&lt;<span class="predefined-type">String</span>&gt; model = <span class="keyword">new</span> ViewModel&lt;<span class="predefined-type">String</span>&gt;()
    model.object = reportRowsBySection
    getRenderer().renderTemplate(<span class="string"><span class="delimiter">&quot;</span><span class="content">hbs/instanceReport</span><span class="delimiter">&quot;</span></span>, model)
}</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
When using custom javascript or stylesheets be sure to use the provided <code>{{nonce}}</code> helper to inject the appropriate nonce token for the <code>Content-Security-Policy</code>.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="approvals-plugin">Approvals plugin</h3>
<div class="paragraph">
<p>Integrate Morpheus with your own ITSM solution. See a <a href="https://github.com/gomorpheus/morpheus-plugin-core/tree/master/samples/morpheus-approvals-plugin">full example</a>.</p>
</div>
<div class="sect3">
<h4 id="setup-4">Setup</h4>
<div class="paragraph">
<p>This plugin will enable you to create configuration for several aspects of Approvals within Morpheus.</p>
</div>
</div>
<div class="sect3">
<h4 id="integration">Integration</h4>
<div class="paragraph">
<p>A new Integration Type will be created when this plugin is installed.
You are able to customize the <code>OptionType</code> for the new Integration using the <code>ApprovalProvider.integrationOptionTypes</code> method.
These <code>OptionType</code> will be visible when creating the new Integration in the Morpheus UI (Administration &#8594; Integrations).</p>
</div>
</div>
<div class="sect3">
<h4 id="policies">Policies</h4>
<div class="paragraph">
<p>Policies (Administration &#8594; Policies in the Morpheus UI) define the conditions in which approval is required for provisioning.
Custom <code>OptionType</code> can be defined for Policy creation by implementing the <code>ApprovalProvider.policyOptionTypes</code> method.</p>
</div>
</div>
<div class="sect3">
<h4 id="create-approval">Create Approval</h4>
<div class="paragraph">
<p><code>ApprovalProvider.createApprovalRequest</code> is called after a Provision Request is created.
Here is where you can send the request to your ITSM.
Each <code>Request</code> will have one or more <code>RequestReference</code> for each resource associated with the provision request.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
It is important that you specify an <code>externalId</code> in the <code>RequestResponse</code> and each <code>RequestReference</code> so that Morpheus can track the approval status.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The <code>integrationOptionTypes</code> you specified are available in the method argument <code>Policy.configMap</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="predefined-type">String</span> itsmEndpoint = accountIntegration.configMap?.cm?.plugin?.<span class="string"><span class="delimiter">&quot;</span><span class="content">itsm-endpoint</span><span class="delimiter">&quot;</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>and the <code>policyOptionTypes</code> you specified are available in the method argument <code>AccountIntegration.configMap</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="predefined-type">String</span> myPolicyConfigValue = policy.configMap?.<span class="string"><span class="delimiter">&quot;</span><span class="content">my-policy-config-option</span><span class="delimiter">&quot;</span></span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="monitor-approval">Monitor Approval</h4>
<div class="paragraph">
<p>At a regular interval, Morpheus checks for Request approvals. In the <code>ApprovalProvider.monitor</code> method
define your logic for retrieving a list of approval requests in your ITSM solution.</p>
</div>
<div class="paragraph">
<p>Approval <code>RequestReference</code> should be returned with one of the following <code>ApprovalStatus</code>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>requesting</code></p>
</li>
<li>
<p><code>requested</code></p>
</li>
<li>
<p><code>error</code></p>
</li>
<li>
<p><code>approved</code></p>
</li>
<li>
<p><code>rejected</code></p>
</li>
<li>
<p><code>cancelled</code></p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="integration-logo">Integration Logo</h4>
<div class="paragraph">
<p>A custom logo can be used in the Morpheus UI by placing an image at <code>src/assets/images/{plugin-code}.png</code>.
Recommended file size is 180 x 60 px.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="ipamdns-plugins">IPAM/DNS Plugins</h3>
<div class="paragraph">
<p>The IPAM and DNS Provider Plugin interfaces provide an easy means to create direct orchestration for IP Address allocation/release as well as DNS Name server registrations. An IPAM Provider is often capable of implementing both interfaces as they often provide both services at once. It is also possible to independently register a <code>DNSProvider</code> only.</p>
</div>
<div class="paragraph">
<p>Both the DNS and IPAM Provider plugins typically consist of just 3 parts. First is defining the provider information such as the configuration options for adding the integration as well as pool types it offers. Secondly periodically syncing state data into morpheus back from the remote integration endpoints. This could include just syncing in available pools or zones, all the way to syncing in all IP host records or DNS zone records. This is up to your implementation.</p>
</div>
<div class="sect3">
<h4 id="setup-5">Setup</h4>
<div class="paragraph">
<p>Before Getting Started, It is recommended to look at the infoblox plugin just to get some bearings. To get started you firstly will create a new class that implements <code>com.morpheusdata.core.IPAMProvider</code> and <code>com.morpheusdata.core.DNSProvider</code>. The Providers requires implementation of several methods including the code required to sync existing records. All sync related code normally lives in here.</p>
</div>
<div class="paragraph">
<p>Both providers also require implementing CRUD based methods for creating host records, deleting host records, as well as creating zone records and deleting zone records. It is important to note that the host record object allows a user to directly enter an ip address to be requested for allocation or, if none is provided, it should be assumed the next available IP should be acquired. Host records are also special in that there are additional options for simultaneously creating DNS records such as A and PTR records. The additional complexity of tieing these pieces into the automated provisioning of workloads is hidden and taken care of by the Morpheus orchestrator.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="cloud-provider-plugins">Cloud Provider Plugins</h3>
<div class="paragraph">
<p>The Cloud provider plugin interfaces are among the more complicated plugin types to implement within Morpheus, but when implemented successfully it provides a very powerful method for creating custom clouds or even updating existing cloud functionality. There are two primary concepts that must first be discussed when developing a cloud plugin.</p>
</div>
<div class="paragraph">
<p>A Cloud plugin typically defines a cloud type (you may see this as <code>zoneType</code> in api for legacy compatibility.) as well as at least one <code>ProvisionProvider</code>. A Provision Provider (also seen in api as <code>provisionType</code>) defines how a resource is provisioned within a cloud. A cloud could offer many provisioning types. For example, Amazon offers both <code>EC2</code> as well as <code>RDS</code>.</p>
</div>
<div class="paragraph">
<p>There are several other provider implementations that are needed on more advanced cloud implementations and some are not yet built out. This includes <code>NetworkProvider</code> and <code>BackupProvider</code> implementations as well as a few more.</p>
</div>
<div class="sect3">
<h4 id="setup-6">Setup</h4>
<div class="paragraph">
<p>Before Getting Started, It is recommended to look at the digital ocean sample plugin just to get some bearings. To get started you firstly will create a new class that implements <code>com.morpheusdata.core.CloudProvider</code>. The <code>CloudProvider</code> requires implementation of several methods including the code required to sync existing workloads from the cloud. All sync related code normally lives in here.</p>
</div>
<div class="paragraph">
<p>On a cloud implementation there are 2 scheduled jobs for refreshing. There is firstly a 5 minute sync job (typically) that syncs state changes on a periodic basis. Then secondly a daily job that runs at Midnight UTC to do larger syncs like price data or things that may change less frequently. Refer to implementations of the <code>refresh()</code> method as well as the <code>refreshDaily()</code> methods.</p>
</div>
<div class="paragraph">
<p>Finally one must also provide the option types inputs for configuring the add cloud wizard as well as the <code>ComputeServerType</code> objects available to this zone type. There should be multiple based often on platform and management state.</p>
</div>
</div>
<div class="sect3">
<h4 id="defining-credentials">Defining Credentials</h4>
<div class="paragraph">
<p>During the <code>refresh()</code> call (and others) the <code>CloudProvider</code> implementation will need to reach out to underlying cloud using credentials. There are two ways to define and store the required credentials.</p>
</div>
<div class="sect5">
<h6 id="using-optiontypes">Using OptionTypes</h6>
<div class="paragraph">
<p>The simplest method is to define <code>OptionType</code> fields (like username and password) and return them on implementation of <code>CloudProvider.getOptionTypes()</code>. These will then be displayed on the Cloud configuration UI. The values can then be obtained during sync operations via the Cloud&#8217;s <code>getConfigMap</code> or directly on the object itself (i.e. <code>serviceUsername</code>) depending on how the <code>OptionType</code> was defined.</p>
</div>
</div>
<div class="sect5">
<h6 id="using-morpheus-credentials">Using Morpheus Credentials</h6>
<div class="paragraph">
<p>A more flexible option is to use Morpheus' built-in Credentials support. With this option, Credentials can be stored securely in Morpheus and utilized in various locations. In order to user this method, a few specific <code>OptionType</code> objects need to be defined. (Refer to <code>VmwareCloudProvider</code> for an example implementation)</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>An <code>OptionType</code> needs to be defined to represent the selection of the Credential type. The following properties must be configured on the <code>OptionType</code>: <code>inputType=OptionType.InputType.CREDENTIAL</code>, <code>fieldContext=credential</code>, <code>fieldName=type</code>, <code>optionSource=credentials</code>. In addition, the <code>config</code> for the <code>OptionType</code> should be something like <code>'{"credentialTypes":["username-password"]}'</code>. Where the array of types may be one or more of <code>username-password,
username-password-keypair,
username-keypair,
access-key-secret,
client-id-secret,
username-api-key,
email-private-key,
tenant-username-keypair,
oauth2,
api-key</code>. These represent the preconfigured credential types in Morpheus.</p>
</li>
<li>
<p><code>OptionType</code> objects need to be defined to represent the 'local' auth values. For example, username and password would need their own <code>OptionType</code>. For these 'local' types, their <code>localCredential</code> value must be <code>true</code></p>
</li>
<li>
<p>Any <code>OptionTypes</code> that should be reloaded when the Credential input changes should include <code>credential-type</code> in their <code>dependsOn</code> value. This will trigger the <code>OptionType</code> <code>optionSource</code> function to be called when the Credentials change.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>To load the Credential information that may be set on a Cloud, the <code>MorpheusCloudService</code> can be used.</p>
</div>
<div class="paragraph">
<p>To load the Credential information from within <code>OptionSourceService</code> implementations (which may be called during Cloud configuration), <code>MorpheusAccountCredentialService</code> may be used to load Credential information from the passed in form options. See <code>VmwareOptionSourceService</code> for an example.</p>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Version 0.13.4-SNAPSHOT<br>
Last updated 2022-07-19 12:07:27 -0600
</div>
</div>
<style>
/* Stylesheet for CodeRay to match GitHub theme | MIT License | http://foundation.zurb.com */
pre.CodeRay{background:#f7f7f8}
.CodeRay .line-numbers{border-right:1px solid currentColor;opacity:.35;padding:0 .5em 0 0}
.CodeRay span.line-numbers{display:inline-block;margin-right:.75em}
.CodeRay .line-numbers strong{color:#000}
table.CodeRay{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.CodeRay td{vertical-align:top;line-height:inherit}
table.CodeRay td.line-numbers{text-align:right}
table.CodeRay td.code{padding:0 0 0 .75em}
.CodeRay .debug{color:#fff !important;background:#000080 !important}
.CodeRay .annotation{color:#007}
.CodeRay .attribute-name{color:#000080}
.CodeRay .attribute-value{color:#700}
.CodeRay .binary{color:#509}
.CodeRay .comment{color:#998;font-style:italic}
.CodeRay .char{color:#04d}
.CodeRay .char .content{color:#04d}
.CodeRay .char .delimiter{color:#039}
.CodeRay .class{color:#458;font-weight:bold}
.CodeRay .complex{color:#a08}
.CodeRay .constant,.CodeRay .predefined-constant{color:#008080}
.CodeRay .color{color:#099}
.CodeRay .class-variable{color:#369}
.CodeRay .decorator{color:#b0b}
.CodeRay .definition{color:#099}
.CodeRay .delimiter{color:#000}
.CodeRay .doc{color:#970}
.CodeRay .doctype{color:#34b}
.CodeRay .doc-string{color:#d42}
.CodeRay .escape{color:#666}
.CodeRay .entity{color:#800}
.CodeRay .error{color:#808}
.CodeRay .exception{color:inherit}
.CodeRay .filename{color:#099}
.CodeRay .function{color:#900;font-weight:bold}
.CodeRay .global-variable{color:#008080}
.CodeRay .hex{color:#058}
.CodeRay .integer,.CodeRay .float{color:#099}
.CodeRay .include{color:#555}
.CodeRay .inline{color:#000}
.CodeRay .inline .inline{background:#ccc}
.CodeRay .inline .inline .inline{background:#bbb}
.CodeRay .inline .inline-delimiter{color:#d14}
.CodeRay .inline-delimiter{color:#d14}
.CodeRay .important{color:#555;font-weight:bold}
.CodeRay .interpreted{color:#b2b}
.CodeRay .instance-variable{color:#008080}
.CodeRay .label{color:#970}
.CodeRay .local-variable{color:#963}
.CodeRay .octal{color:#40e}
.CodeRay .predefined{color:#369}
.CodeRay .preprocessor{color:#579}
.CodeRay .pseudo-class{color:#555}
.CodeRay .directive{font-weight:bold}
.CodeRay .type{font-weight:bold}
.CodeRay .predefined-type{color:inherit}
.CodeRay .reserved,.CodeRay .keyword {color:#000;font-weight:bold}
.CodeRay .key{color:#808}
.CodeRay .key .delimiter{color:#606}
.CodeRay .key .char{color:#80f}
.CodeRay .value{color:#088}
.CodeRay .regexp .delimiter{color:#808}
.CodeRay .regexp .content{color:#808}
.CodeRay .regexp .modifier{color:#808}
.CodeRay .regexp .char{color:#d14}
.CodeRay .regexp .function{color:#404;font-weight:bold}
.CodeRay .string{color:#d20}
.CodeRay .string .string .string{background:#ffd0d0}
.CodeRay .string .content{color:#d14}
.CodeRay .string .char{color:#d14}
.CodeRay .string .delimiter{color:#d14}
.CodeRay .shell{color:#d14}
.CodeRay .shell .delimiter{color:#d14}
.CodeRay .symbol{color:#990073}
.CodeRay .symbol .content{color:#a60}
.CodeRay .symbol .delimiter{color:#630}
.CodeRay .tag{color:#008080}
.CodeRay .tag-special{color:#d70}
.CodeRay .variable{color:#036}
.CodeRay .insert{background:#afa}
.CodeRay .delete{background:#faa}
.CodeRay .change{color:#aaf;background:#007}
.CodeRay .head{color:#f8f;background:#505}
.CodeRay .insert .insert{color:#080}
.CodeRay .delete .delete{color:#800}
.CodeRay .change .change{color:#66f}
.CodeRay .head .head{color:#f4f}
</style>
</body>
</html>